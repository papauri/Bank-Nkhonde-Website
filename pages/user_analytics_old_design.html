<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Analytics - Bank Nkhonde">
  <title>Analytics - Bank Nkhonde</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../styles/design-system.css">
  <link rel="stylesheet" href="../styles/dashboard.css">
  <link rel="icon" type="image/png" href="../assets/favicon.png">
</head>
<body>
  <!-- Background Decoration -->
  <div class="dashboard-bg">
    <div class="dashboard-bg-shape dashboard-bg-shape-1"></div>
    <div class="dashboard-bg-shape dashboard-bg-shape-2"></div>
    <div class="dashboard-bg-shape dashboard-bg-shape-3"></div>
  </div>

  <!-- Main Container -->
  <div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header">
      <div class="dashboard-header-top">
        <div class="dashboard-header-title">
          <h1>Analytics</h1>
          <p>Track your contributions and group performance</p>
        </div>
        <div class="dashboard-header-actions">
          <button class="dashboard-header-btn" onclick="history.back()" aria-label="Back">‚Üê</button>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="content-section" style="margin-bottom: var(--bn-space-lg); padding: 0;">
      <div style="display: flex; gap: 8px; border-bottom: 2px solid rgba(255, 255, 255, 0.1);">
        <button class="tab-btn active" data-tab="contributions">Contributions</button>
        <button class="tab-btn" data-tab="loans">Loans</button>
        <button class="tab-btn" data-tab="bookings">Loan Bookings</button>
      </div>
    </div>

    <!-- Group Selector -->
    <div class="content-section" style="margin-bottom: var(--bn-space-lg);">
      <select id="groupSelector" class="form-input" style="width: 100%;">
        <option value="">Select a group...</option>
      </select>
    </div>

    <!-- Contributions Tab -->
    <div id="contributionsTab" class="tab-content active">
      <!-- Statistics -->
      <div class="stats-grid" style="margin-bottom: var(--bn-space-xl);">
        <div class="stat-card info">
          <div class="stat-label">Monthly Contribution</div>
          <div class="stat-value" id="monthlyContribution">MWK 0</div>
        </div>
        <div class="stat-card success">
          <div class="stat-label">Yearly Total</div>
          <div class="stat-value" id="yearlyTotal">MWK 0</div>
        </div>
        <div class="stat-card warning">
          <div class="stat-label">Your Contributions</div>
          <div class="stat-value" id="yourContributions">MWK 0</div>
        </div>
        <div class="stat-card primary">
          <div class="stat-label">Group Total</div>
          <div class="stat-value" id="groupTotal">MWK 0</div>
        </div>
      </div>

      <!-- Monthly Breakdown -->
      <div class="content-section">
        <div class="content-section-header">
          <h2 class="content-section-title">Monthly Breakdown</h2>
        </div>
        <div id="monthlyBreakdown">
          <div class="empty-state">
            <div class="empty-state-icon">üìä</div>
            <p class="empty-state-text">Select a group to view breakdown</p>
          </div>
        </div>
      </div>

      <!-- Your Contribution History -->
      <div class="content-section">
        <div class="content-section-header">
          <h2 class="content-section-title">Your Contribution History</h2>
        </div>
        <div id="contributionHistory">
          <div class="empty-state">
            <div class="empty-state-icon">üìã</div>
            <p class="empty-state-text">No contribution history</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Loans Tab -->
    <div id="loansTab" class="tab-content" style="display: none;">
      <!-- Statistics -->
      <div class="stats-grid" style="margin-bottom: var(--bn-space-xl);">
        <div class="stat-card info">
          <div class="stat-label">Active Loans</div>
          <div class="stat-value" id="activeLoansCount">0</div>
        </div>
        <div class="stat-card warning">
          <div class="stat-label">Outstanding</div>
          <div class="stat-value" id="outstandingLoans">MWK 0</div>
        </div>
        <div class="stat-card success">
          <div class="stat-label">Total Paid</div>
          <div class="stat-value" id="totalLoansPaid">MWK 0</div>
        </div>
        <div class="stat-card primary">
          <div class="stat-label">Next Disbursement</div>
          <div class="stat-value" id="nextDisbursement">MWK 0</div>
        </div>
      </div>

      <!-- Loans Being Disbursed -->
      <div class="content-section">
        <div class="content-section-header">
          <h2 class="content-section-title">Loans Being Disbursed This Cycle</h2>
        </div>
        <div id="disbursedLoans">
          <div class="empty-state">
            <div class="empty-state-icon">üí∞</div>
            <p class="empty-state-text">No loans being disbursed</p>
          </div>
        </div>
      </div>

      <!-- Your Loans -->
      <div class="content-section">
        <div class="content-section-header">
          <h2 class="content-section-title">Your Loans</h2>
        </div>
        <div id="yourLoans">
          <div class="empty-state">
            <div class="empty-state-icon">üìã</div>
            <p class="empty-state-text">No loans found</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Bookings Tab -->
    <div id="bookingsTab" class="tab-content" style="display: none;">
      <!-- Book Loan Section -->
      <div class="content-section">
        <div class="content-section-header">
          <h2 class="content-section-title">Book a Loan</h2>
        </div>
        <div style="padding: var(--bn-space-lg);">
          <p style="margin-bottom: var(--bn-space-md); color: rgba(255, 255, 255, 0.8);">
            Book your position for the next loan cycle. You'll be notified when loans are available.
          </p>
          <button class="btn btn-primary btn-block" id="bookLoanBtn">Book Loan Position</button>
        </div>
      </div>

      <!-- Your Bookings -->
      <div class="content-section">
        <div class="content-section-header">
          <h2 class="content-section-title">Your Bookings</h2>
        </div>
        <div id="yourBookings">
          <div class="empty-state">
            <div class="empty-state-icon">üìÖ</div>
            <p class="empty-state-text">No bookings found</p>
          </div>
        </div>
      </div>

      <!-- Booking Queue -->
      <div class="content-section">
        <div class="content-section-header">
          <h2 class="content-section-title">Booking Queue</h2>
        </div>
        <div id="bookingQueue">
          <div class="empty-state">
            <div class="empty-state-icon">üìä</div>
            <p class="empty-state-text">Select a group to view queue</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Book Loan Modal -->
  <div class="modal-overlay hidden" id="bookLoanModal">
    <div class="modal-content">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--bn-space-lg);">
        <h2 style="margin: 0;">Book Loan Position</h2>
        <button id="closeBookLoanModal" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--bn-dark);">&times;</button>
      </div>
      <form id="bookLoanForm">
        <div class="form-group">
          <label class="form-label">Preferred Loan Amount (MWK)</label>
          <input type="number" id="preferredAmount" class="form-input" placeholder="Enter preferred amount" required min="1" step="0.01">
        </div>
        <div class="form-group">
          <label class="form-label">Purpose</label>
          <select id="loanPurpose" class="form-select" required>
            <option value="">Select purpose...</option>
            <option value="business">Business</option>
            <option value="education">Education</option>
            <option value="medical">Medical</option>
            <option value="emergency">Emergency</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Description (Optional)</label>
          <textarea id="loanDescription" class="form-textarea" rows="3" placeholder="Brief description of what you need the loan for..."></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Preferred Cycle (Optional)</label>
          <input type="month" id="preferredCycle" class="form-input">
        </div>
        <button type="submit" class="btn btn-primary btn-block">Submit Booking</button>
      </form>
    </div>
  </div>

  <!-- Mobile Navigation -->
  <nav class="mobile-nav">
    <a href="user_dashboard.html" class="mobile-nav-item">
      <span class="mobile-nav-icon">üè†</span>
      <span>Dashboard</span>
    </a>
    <a href="user_analytics.html" class="mobile-nav-item active">
      <span class="mobile-nav-icon">üìä</span>
      <span>Analytics</span>
    </a>
    <a href="loan_payments.html" class="mobile-nav-item">
      <span class="mobile-nav-icon">üí∞</span>
      <span>Loans</span>
    </a>
    <a href="contacts.html" class="mobile-nav-item">
      <span class="mobile-nav-icon">üë•</span>
      <span>Members</span>
    </a>
  </nav>

  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
  <script type="module" src="../scripts/user_analytics.js"></script>
  <style>
    .tab-btn {
      padding: var(--bn-space-sm) var(--bn-space-md);
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.7);
      font-size: var(--bn-font-base);
      font-weight: 500;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all var(--bn-transition-base);
    }
    .tab-btn.active {
      color: var(--bn-white);
      border-bottom-color: var(--bn-primary);
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
  </style>
</body>
</html>
